(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{384:function(a,t,s){"use strict";s.r(t);var e=s(4),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h3",{attrs:{id:"说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[a._v("#")]),a._v(" 说明")]),a._v(" "),t("ol",[t("li",[a._v("zerotier网络1，网段 192.168.88.0/24，添加路由192.168.99.0/24 > 192.168.88.254")]),a._v(" "),t("li",[a._v("zerotier网络2，网段 192.168.99.0/24，添加路由192.168.88.0/24 > 192.168.99.254")])]),a._v(" "),t("h3",{attrs:{id:"搭建wireguard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建wireguard"}},[a._v("#")]),a._v(" 搭建wireguard")]),a._v(" "),t("h4",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" wireguard\n")])])]),t("h4",{attrs:{id:"配置环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置环境"}},[a._v("#")]),a._v(" 配置环境")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"net.core.default_qdisc=fq"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /etc/sysctl.conf\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"net.ipv4.ip_forward=1"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /etc/sysctl.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sysctl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("\n")])])]),t("h4",{attrs:{id:"生成密钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成密钥"}},[a._v("#")]),a._v(" 生成密钥")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("wg genkey "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" privatekey "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" wg pubkey "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" publickey\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" privatekey\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" publickey\n")])])]),t("h4",{attrs:{id:"服务端配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务端配置"}},[a._v("#")]),a._v(" 服务端配置")]),a._v(" "),t("blockquote",[t("p",[a._v("zerotier网络ip微"),t("code",[a._v("192.168.99.254")]),a._v("，编辑"),t("code",[a._v("/etc/wireguard/wg0.conf")])])]),a._v(" "),t("div",{staticClass:"language-conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("Address = 10.0.20.10/24\nMTU = 1420\nPostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o ztbuahbova -j MASQUERADE\nPostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -D FORWARD -o wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o ztbuahbova -j MASQUERADE\nListenPort = 28721\nPrivateKey = <PrivateKey>\n\n[Peer]\nPublicKey = <192.168.88.254的PublicKey>\nPresharedKey = <可选PresharedKey>\nAllowedIPs = 192.168.88.0/24,10.0.20.11/32\n")])])]),t("h4",{attrs:{id:"客户端配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端配置"}},[a._v("#")]),a._v(" 客户端配置")]),a._v(" "),t("blockquote",[t("p",[a._v("zerotier网络ip微"),t("code",[a._v("192.168.88.254")]),a._v("，编辑"),t("code",[a._v("/etc/wireguard/wg0.conf")])])]),a._v(" "),t("div",{staticClass:"language-conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("[Interface]\nAddress = 10.0.20.11/24\nMTU = 1420\nPostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o ztfr4475ka -j MASQUERADE\nPostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -D FORWARD -o wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o ztfr4475ka -j MASQUERADE\nPrivateKey = <PrivateKey>\n\n[Peer]\nPublicKey = <192.168.99.254的PublicKey>\nPresharedKey = <可选PresharedKey>\nAllowedIPs = 192.168.99.0/24,10.0.20.10/32\nEndpoint = <服务端公网ip>:28721\nPersistentKeepalive = 20\n")])])]),t("h4",{attrs:{id:"启动服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动服务"}},[a._v("#")]),a._v(" 启动服务")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" wg-quick@wg0\nsystemctl restart wg-quick@wg0\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);