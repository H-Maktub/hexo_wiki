(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{382:function(e,_,t){"use strict";t.r(_);var a=t(4),v=Object(a.a)({},(function(){var e=this,_=e._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[_("h2",{attrs:{id:"_0-说明"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_0-说明"}},[e._v("#")]),e._v(" 0.说明")]),e._v(" "),_("p",[e._v("根据步骤一步一步来，如果提示错误，请自查步骤是否错误")]),e._v(" "),_("h2",{attrs:{id:"_1-注册企业微信"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-注册企业微信"}},[e._v("#")]),e._v(" 1. 注册企业微信")]),e._v(" "),_("ul",[_("li",[e._v("注册地址"),_("a",{attrs:{href:"https://work.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://work.weixin.qq.com/"),_("OutboundLink")],1),e._v(",自己填资料，步骤省略")]),e._v(" "),_("li",[_("code",[e._v("我的企业")]),e._v("--\x3e"),_("code",[e._v("企业信息")]),e._v("->记录"),_("code",[e._v("企业ID")])])]),e._v(" "),_("h2",{attrs:{id:"_2-caddy设置请求代理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-caddy设置请求代理"}},[e._v("#")]),e._v(" 2. caddy设置请求代理")]),e._v(" "),_("blockquote",[_("p",[e._v("需要VPS，下面配置，匹配指定path，其他路径全部拒绝，编辑"),_("code",[e._v("/etc/caddy/Caddyfile")])])]),e._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[e._v("# 企业微信代理\n# 通过异地组网ip,不暴露接口\n:PORT {\n    bind <服务器的Zerotier_ip>\n    @message {\n        expression `path('/cgi-bin/gettoken') || path('/cgi-bin/message/send') || path('/cgi-bin/menu/create')`\n    }\n    handle @message {\n        reverse_proxy https://qyapi.weixin.qq.com {\n            header_up Host {upstream_hostport}\n        }\n    }\n    handle {\n        abort\n    } \n}\n\n# 消息回调\n:PORT {\n    @message {\n        path /api/v1/message/\n        query test=<自定义校验>\n    }\n    handle @message {\n        # 异地组网ip\n        uri query -test\n        reverse_proxy http://<MP的zerotier_ip>:3000\n    }\n    handle {\n        abort\n    }\n}\n")])])]),_("h2",{attrs:{id:"_3-创建企业微信插件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建企业微信插件"}},[e._v("#")]),e._v(" 3. 创建企业微信插件")]),e._v(" "),_("ul",[_("li",[_("code",[e._v("应用管理")]),e._v("--\x3e"),_("code",[e._v("应用")]),e._v("--\x3e"),_("code",[e._v("自建")]),e._v("->"),_("code",[e._v("创建应用")])]),e._v(" "),_("li",[e._v("记录插件"),_("code",[e._v("AgentId")]),e._v("和"),_("code",[e._v("Secret")])]),e._v(" "),_("li",[e._v("进应用设置，设置"),_("code",[e._v("接收消息")])]),e._v(" "),_("li",[_("code",[e._v("URL")]),e._v("写入上面caddy配置"),_("code",[e._v("http://DOMAIN:PORT/api/v1/message/")])]),e._v(" "),_("li",[e._v("随机生成"),_("code",[e._v("Token")])]),e._v(" "),_("li",[e._v("随机生成"),_("code",[e._v("EncodingAESKey")])]),e._v(" "),_("li",[e._v("先不要保存，先配置"),_("code",[e._v("MoviePilot")])])]),e._v(" "),_("h2",{attrs:{id:"_4-配置moviepilot通知"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置moviepilot通知"}},[e._v("#")]),e._v(" 4.配置MoviePilot通知")]),e._v(" "),_("p",[e._v("编辑"),_("code",[e._v("docker-compose.yml")]),e._v("的"),_("code",[e._v("environment")]),e._v(",添加如下内容")]),e._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[e._v('# 微信通知\n- MESSAGER=wechat\n- WECHAT_CORPID=<企业ID>\n- WECHAT_APP_SECRET=<插件Secret>\n- WECHAT_APP_ID=<插件AgentId>\n- WECHAT_TOKEN=<接收消息Token>\n- WECHAT_ENCODING_AESKEY=<接收消息EncodingAESKey>\n- WECHAT_ADMINS=<通讯录成员详情的"账号"字段>\n- WECHAT_PROXY=<服务器的Zerotier_ip,http://DOMAIN:PORT>\n')])])]),_("p",[e._v("重启"),_("code",[e._v("MoviePilot")])]),e._v(" "),_("h2",{attrs:{id:"_5-回到企业微信插件接收消息配置"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_5-回到企业微信插件接收消息配置"}},[e._v("#")]),e._v(" 5. 回到企业微信插件"),_("code",[e._v("接收消息")]),e._v("配置")]),e._v(" "),_("ul",[_("li",[e._v("点击保存，如果提示api调用失败，则是"),_("code",[e._v("/api/v1/message")]),e._v("转发失败，请检查配置")]),e._v(" "),_("li",[e._v("回到插件详情页，"),_("code",[e._v("开发者接口")]),e._v("--\x3e"),_("code",[e._v("企业可信IP")]),e._v("，填入vps ip")])]),e._v(" "),_("h2",{attrs:{id:"_6-个人微信接收"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_6-个人微信接收"}},[e._v("#")]),e._v(" 6. 个人微信接收")]),e._v(" "),_("ul",[_("li",[_("code",[e._v("我的企业")]),e._v("--\x3e"),_("code",[e._v("微信插件")]),e._v("--\x3e"),_("code",[e._v("邀请关注")]),e._v(",扫描二维码，通过微信接收企业微信消息")])])])}),[],!1,null,null,null);_.default=v.exports}}]);